var container = new Vue({
    el:'#container',
    data:{
        addUserDialog:false,
        editUserDialog:false,
        editDialogTitle:'',
        addForm:{
            username:'',
            nickname:'',
            password:'',
            email:'',
            department:'',
            permission:''
        },
        editForm:{
            userId:'',
            department:'',
            permission:''
        },
        departments:[],
        permissions:[],
        depData:[
            {depName:'教务处',depId:2,depManagerSum:27,depTel:87654321},
            {depName:'信通院',depId:1,depManagerSum:64,depTel:12345678}
        ],
        pagination:{
            currentPage:1,
            total:0,
            size:20
        }
    },
    mounted:function(){
        this.getDepartments();
        this.getDepData();
    },
    methods:{
        getDepData:function(){
            $.get({
                url:'getDepData',
                data:{
                    currentPage:this.pagination.currentPage
                },
                success:function(response){
                    console.log(response);
                },
                error:function(response){
                    container.$message.error('获取用户数据失败');
                }
            })
        },
        getPermission:function(){
            $.get({
                url:'getAllPermission',
                success:function(response){
                    console.log(response);
                },
                error:function(response){
                    container.$message.error('获取权限失败');
                }
            })
        },
        getDepartments:function(){
            $.get({
                url:'getAllDepartment',
                success:function(response){
                    for(var i in response) {
                        container.departments.push({
                            label:response[i].name,
                            value:response[i].id
                        });
                    }
                },
                error:function(response){
                    container.$message.error('获取部门失败');
                }
            });
        },
        onAdd:function(){
            $.post({
                url:'addUser',
                data:this.addForm,
                success:function(response){
                    container.$message.success('添加用户成功');
                },
                error:function(response){
                    container.$message.error('添加用户失败');
                }
            })
        },
        editUser:function(index,row){
            this.editForm.userId = row.userId;
            this.editDialogTitle = '修改用户：' + row.username;
            this.editForm.department = row.department;
            this.editForm.permission = row.permission;
            this.editUserDialog = true;
        },
        onEdit:function(){
            $.ajax({
                url:'editUser',
                type:'PUT',
                data:this.editForm,
                success:function(response){
                    container.$message.success('修改用户成功');
                },
                error:function(response){
                    container.$message.error('修改用户失败');
                }
            })
        },
        deleteUser:function(index,row){
            console.log(index,row);
            $.ajax({
                url:'deleteUser',
                type:'DELETE',
                data:row.userId,
                success:function(response){
                    container.$message.success('删除用户：' + row.nickname + '成功');
                },
                error:function(response){
                    container.$message.error('删除用户：' + row.nickname + '失败');
                }
            })
        },
        onCancel:function(){

        },
        handleCurrentChange:function(){}
    }
});