var container = new Vue({
	el:'#container',
	data:{
		//添加用户对话框
        addUserDialog:false,
		//编辑用户对话框
        editUserDialog:false,
		//编辑用户对话框标题
        editDialogTitle:'',
		//添加用户表单
        addForm:{
        	username:'',
            nickname:'',
            password:'',
            email:'',
            department:'',
            permission:''
        },
		//编辑用户表单
		editForm:{
        	userId:'',
			department:'',
			permission:''
		},
		//部门数组
		departments:[],
		//权限数组
		permissions:[],
		//用户信息数组，将获取到的用户数据放入这个数组，现在是假的数据
		userData:[
			{userId:'1',username:'asd',nickname:'feafe',password:'qwe',email:'adewfe',department:'1',permission:'2'}
		],
		pagination:{
			currentPage:1,
			total:0,
			size:20
		}
	},
	mounted:function(){
		this.getDepartments();
		this.getUserData();
	},
	methods:{
		//获取用户数据
		getUserData:function(){
			$.get({
				url:'getUserData',
				data:{
					currentPage:this.pagination.currentPage
				},
				success:function(response){
					console.log(response);
				},
				error:function(response){
					container.$message.error('获取用户数据失败');
				}
			})
		},
		//获取权限等级
		getPermission:function(){
			$.get({
				url:'getAllPermission',
				success:function(response){
					console.log(response);
				},
				error:function(response){
					container.$message.error('获取权限失败');
				}
			})
		},
		getDepartments:function(){
            $.get({
                url:'getAllDepartment',
                success:function(response){
                    for(var i in response) {
                        container.departments.push({
                            label:response[i].name,
                            value:response[i].id
                        });
                    }
                },
                error:function(response){
                    container.$message.error('获取部门失败');
                }
            });
		},
		//提交添加
        onAdd:function(){
			$.post({
				url:'addUser',
				data:this.addForm,
				success:function(response){
					container.$message.success('添加用户成功');
				},
				error:function(response){
					container.$message.error('添加用户失败');
				}
			})
		},
		//修改用户时将所选用户的信息放入表单
		editUser:function(index,row){
        	this.editForm.userId = row.userId;
        	this.editDialogTitle = '修改用户：' + row.username;
        	this.editForm.department = row.department;
        	this.editForm.permission = row.permission;
        	this.editUserDialog = true;
		},
		//提交修改
		onEdit:function(){
            $.ajax({
                url:'editUser',
				type:'PUT',
                data:this.editForm,
                success:function(response){
                    container.$message.success('修改用户成功');
                },
                error:function(response){
                    container.$message.error('修改用户失败');
                }
            })
		},
		//删除用户，未完成
		deleteUser:function(index,row){
        	console.log(index,row);
        	$.ajax({
        		url:'deleteUser',
				type:'DELETE',
				data:row.userId,
				success:function(response){
        			container.$message.success('删除用户：' + row.nickname + '成功');
				},
				error:function(response){
                    container.$message.error('删除用户：' + row.nickname + '失败');
				}
			})
		},
		onCancel:function(){},
		handleCurrentChange:function(){}
	}
});